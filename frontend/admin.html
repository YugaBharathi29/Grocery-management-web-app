<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - GroceryMart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #2d8f47 0%, #1e5f32 100%);
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 20px;
            margin: 5px 0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .main-content {
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .table-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="sidebar d-flex flex-column">
                    <div class="p-4">
                        <h4 class="text-white">
                            <i class="bi bi-shield-check"></i> Admin Panel
                        </h4>
                        <p class="text-white-50 mb-0">GroceryMart</p>
                    </div>
                    
                    <nav class="nav flex-column px-3">
                        <a class="nav-link active" href="#" id="dashboardTab">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                        <a class="nav-link" href="#" id="productsTab">
                            <i class="bi bi-box-seam"></i> Products
                        </a>
                        <a class="nav-link" href="#" id="categoriesTab">
                            <i class="bi bi-tags"></i> Categories
                        </a>
                        <a class="nav-link" href="#" id="ordersTab">
                            <i class="bi bi-cart-check"></i> Orders
                        </a>
                    </nav>
                    
                    <div class="mt-auto p-3">
                        <button class="btn btn-outline-light w-100" onclick="goToStore()">
                            <i class="bi bi-arrow-left"></i> Back to Store
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content p-4">
                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2 id="pageTitle">Dashboard</h2>
                            <p class="text-muted mb-0" id="pageSubtitle">Overview of your store</p>
                        </div>
                        <div>
                            <span class="text-muted">Welcome back, <strong id="adminName">Admin</strong></span>
                            <button class="btn btn-outline-danger ms-3" onclick="logout()">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dashboard Content -->
                    <div id="dashboardContent">
                        <!-- Stats Cards -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="stats-card text-center">
                                    <div class="stats-icon bg-primary bg-opacity-10 text-primary mx-auto mb-3">
                                        <i class="bi bi-box-seam"></i>
                                    </div>
                                    <h3 class="mb-1" id="totalProducts">0</h3>
                                    <p class="text-muted mb-0">Total Products</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card text-center">
                                    <div class="stats-icon bg-success bg-opacity-10 text-success mx-auto mb-3">
                                        <i class="bi bi-cart-check"></i>
                                    </div>
                                    <h3 class="mb-1" id="totalOrders">0</h3>
                                    <p class="text-muted mb-0">Total Orders</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card text-center">
                                    <div class="stats-icon bg-warning bg-opacity-10 text-warning mx-auto mb-3">
                                        <i class="bi bi-people"></i>
                                    </div>
                                    <h3 class="mb-1" id="totalCustomers">0</h3>
                                    <p class="text-muted mb-0">Total Customers</p>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card text-center">
                                    <div class="stats-icon bg-info bg-opacity-10 text-info mx-auto mb-3">
                                        <i class="bi bi-currency-dollar"></i>
                                    </div>
                                    <h3 class="mb-1" id="totalRevenue">$0</h3>
                                    <p class="text-muted mb-0">Total Revenue</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Orders -->
                        <div class="table-card">
                            <div class="card-header bg-transparent border-0 p-4">
                                <h5 class="mb-0">Recent Orders</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Order ID</th>
                                                <th>Customer</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentOrdersTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Products Content -->
                    <div id="productsContent" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div></div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                                <i class="bi bi-plus"></i> Add Product
                            </button>
                        </div>
                        
                        <div class="table-card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Image</th>
                                                <th>Name</th>
                                                <th>Category</th>
                                                <th>Price</th>
                                                <th>Stock</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productsTable">
                                            <tr>
                                                <td colspan="7" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Categories Content -->
                    <div id="categoriesContent" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div></div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                                <i class="bi bi-plus"></i> Add Category
                            </button>
                        </div>
                        
                        <div class="table-card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Description</th>
                                                <th>Products Count</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="categoriesTable">
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Content -->
                    <div id="ordersContent" style="display: none;">
                        <div class="table-card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Order ID</th>
                                                <th>Customer</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="allOrdersTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-4">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="productName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="productCategory" class="form-label">Category</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="productPrice" class="form-label">Price</label>
                                <input type="number" class="form-control" id="productPrice" step="0.01" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="productStock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="productSku" class="form-label">SKU</label>
                                <input type="text" class="form-control" id="productSku">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productImage" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="productImage">
                        </div>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Category Modal -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCategoryForm">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Category Name</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="categoryDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="categoryImage" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="categoryImage">
                        </div>
                        <button type="submit" class="btn btn-primary">Add Category</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        let currentUser = null;
        let allProducts = [];
        let allCategories = [];
        let allOrders = [];
        
        // API call function
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include'
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'API call failed');
                }
                
                return result;
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }
        }
    }
    
    // ADD THE NEW ADMIN FUNCTIONS HERE:
    
    // REPLACE editProduct function (find it further down in your file)
    async function editProduct(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        // Populate edit form with current product data
        document.getElementById('productName').value = product.name;
        document.getElementById('productDescription').value = product.description || '';
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productStock').value = product.stock_quantity;
        document.getElementById('productCategory').value = product.category_id;
        document.getElementById('productImage').value = product.image_url || '';
        document.getElementById('productSku').value = product.sku || '';
        
        // Change modal title and form behavior
        document.querySelector('#addProductModal .modal-title').textContent = 'Edit Product';
        document.getElementById('addProductForm').dataset.editId = productId;
        
        // Show modal
        new bootstrap.Modal(document.getElementById('addProductModal')).show();
    }
    
    // ... (add the rest of the functions here)
    
    // Utility functions
        
        // Utility functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 5000);
        }
        
        function formatPrice(price) {
            return `$${parseFloat(price).toFixed(2)}`;
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }
        
        function getStatusBadge(status) {
            const statusClasses = {
                'pending': 'bg-warning text-dark',
                'confirmed': 'bg-info text-white',
                'processing': 'bg-primary text-white',
                'shipped': 'bg-secondary text-white',
                'delivered': 'bg-success text-white',
                'cancelled': 'bg-danger text-white'
            };
            
            return `<span class="status-badge ${statusClasses[status] || 'bg-secondary text-white'}">${status}</span>`;
        }
        
        // Check admin authentication
        async function checkAdminAuth() {
            try {
                const profile = await apiCall('/auth/profile');
                if (profile.role !== 'admin') {
                    alert('Access denied. Admin privileges required.');
                    window.location.href = 'index.html';
                    return false;
                }
                currentUser = profile;
                document.getElementById('adminName').textContent = profile.first_name;
                return true;
            } catch (error) {
                alert('Please log in as an administrator.');
                window.location.href = 'index.html';
                return false;
            }
        }
        
        // Navigation functions
        function showSection(sectionId) {
            // Hide all content sections
            document.querySelectorAll('[id$="Content"]').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionId + 'Content').style.display = 'block';
            
            // Update navigation
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(sectionId + 'Tab').classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': { title: 'Dashboard', subtitle: 'Overview of your store' },
                'products': { title: 'Products', subtitle: 'Manage your products' },
                'categories': { title: 'Categories', subtitle: 'Manage product categories' },
                'orders': { title: 'Orders', subtitle: 'Manage customer orders' }
            };
            
            document.getElementById('pageTitle').textContent = titles[sectionId].title;
            document.getElementById('pageSubtitle').textContent = titles[sectionId].subtitle;
            
            // Load section data
            switch (sectionId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'products':
                    loadProductsData();
                    break;
                case 'categories':
                    loadCategoriesData();
                    break;
                case 'orders':
                    loadOrdersData();
                    break;
            }
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load products
                allProducts = await apiCall('/products');
                document.getElementById('totalProducts').textContent = allProducts.length;
                
                // Load orders
                allOrders = await apiCall('/admin/orders');
                document.getElementById('totalOrders').textContent = allOrders.length;
                
                // Calculate revenue
                const totalRevenue = allOrders.reduce((sum, order) => sum + parseFloat(order.total_amount), 0);
                document.getElementById('totalRevenue').textContent = formatPrice(totalRevenue);
                
                // Get unique customers count
                const uniqueCustomers = new Set(allOrders.map(order => order.user_name)).size;
                document.getElementById('totalCustomers').textContent = uniqueCustomers;
                
                // Load categories
                allCategories = await apiCall('/categories');
                
                // Update recent orders table
                renderRecentOrders(allOrders.slice(0, 10));
                
            } catch (error) {
                showToast('Failed to load dashboard data', 'danger');
            }
        }
        
        // Load products data
        async function loadProductsData() {
            try {
                allProducts = await apiCall('/products');
                if (allCategories.length === 0) {
                    allCategories = await apiCall('/categories');
                }
                renderProducts();
                populateProductCategories();
            } catch (error) {
                showToast('Failed to load products data', 'danger');
            }
        }
        
        // Load categories data
        async function loadCategoriesData() {
            try {
                allCategories = await apiCall('/categories');
                if (allProducts.length === 0) {
                    allProducts = await apiCall('/products');
                }
                renderCategories();
            } catch (error) {
                showToast('Failed to load categories data', 'danger');
            }
        }
        
        // Load orders data
        async function loadOrdersData() {
            try {
                allOrders = await apiCall('/admin/orders');
                renderAllOrders();
            } catch (error) {
                showToast('Failed to load orders data', 'danger');
            }
        }
        
        // Render functions
        function renderRecentOrders(orders) {
            const tbody = document.getElementById('recentOrdersTable');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No orders found</td></tr>';
                return;
            }
            
            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.user_name}</td>
                    <td>${formatPrice(order.total_amount)}</td>
                    <td>${getStatusBadge(order.status)}</td>
                    <td>${formatDate(order.created_at)}</td>
                    <td>
                        <select class="form-select form-select-sm" onchange="updateOrderStatus(${order.id}, this.value)">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }
        
        function renderProducts() {
            const tbody = document.getElementById('productsTable');
            
            if (allProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No products found</td></tr>';
                return;
            }
            
            tbody.innerHTML = allProducts.map(product => {
                const category = allCategories.find(cat => cat.id === product.category_id);
                return `
                    <tr>
                        <td>
                            <img src="${product.image_url || 'https://via.placeholder.com/50x40'}" 
                                 class="img-thumbnail" style="width: 50px; height: 40px; object-fit: cover;" 
                                 alt="${product.name}">
                        </td>
                        <td>${product.name}</td>
                        <td>${category ? category.name : 'N/A'}</td>
                        <td>${formatPrice(product.price)}</td>
                        <td>
                            <span class="badge ${product.stock_quantity > 10 ? 'bg-success' : product.stock_quantity > 0 ? 'bg-warning' : 'bg-danger'}">
                                ${product.stock_quantity}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${product.is_active ? 'bg-success' : 'bg-danger'}">
                                ${product.is_active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editProduct(${product.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderCategories() {
            const tbody = document.getElementById('categoriesTable');
            
            if (allCategories.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">No categories found</td></tr>';
                return;
            }
            
            tbody.innerHTML = allCategories.map(category => {
                const productCount = allProducts.filter(p => p.category_id === category.id).length;
                return `
                    <tr>
                        <td>${category.name}</td>
                        <td>${category.description || 'N/A'}</td>
                        <td><span class="badge bg-info">${productCount}</span></td>
                        <td>
                            <span class="badge ${category.is_active ? 'bg-success' : 'bg-danger'}">
                                ${category.is_active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editCategory(${category.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${category.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderAllOrders() {
            const tbody = document.getElementById('allOrdersTable');
            
            if (allOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-4">No orders found</td></tr>';
                return;
            }
            
            tbody.innerHTML = allOrders.map(order => `
                <tr>
                    <td>#${order.id}</td>
                    <td>${order.user_name}</td>
                    <td>${formatPrice(order.total_amount)}</td>
                    <td>${getStatusBadge(order.status)}</td>
                    <td>${formatDate(order.created_at)}</td>
                    <td>
                        <select class="form-select form-select-sm" onchange="updateOrderStatus(${order.id}, this.value)">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }
        
        function populateProductCategories() {
            const select = document.getElementById('productCategory');
            select.innerHTML = '<option value="">Select Category</option>' +
                allCategories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
        }
        
        // Action functions
        async function updateOrderStatus(orderId, status) {
            try {
                await apiCall(`/admin/orders/${orderId}/status`, 'PUT', { status });
                showToast('Order status updated successfully', 'success');
                
                // Update the order in our local array
                const orderIndex = allOrders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    allOrders[orderIndex].status = status;
                }
                
                // Refresh dashboard if we're on it
                if (document.getElementById('dashboardContent').style.display !== 'none') {
                    renderRecentOrders(allOrders.slice(0, 10));
                }
            } catch (error) {
                showToast('Failed to update order status', 'danger');
            }
        }
        
        async function addProduct(productData) {
            try {
                await apiCall('/products', 'POST', productData);
                showToast('Product added successfully', 'success');
                await loadProductsData();
                bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                document.getElementById('addProductForm').reset();
            } catch (error) {
                showToast('Failed to add product', 'danger');
            }
        }
        
        async function addCategory(categoryData) {
            try {
                await apiCall('/categories', 'POST', categoryData);
                showToast('Category added successfully', 'success');
                await loadCategoriesData();
                bootstrap.Modal.getInstance(document.getElementById('addCategoryModal')).hide();
                document.getElementById('addCategoryForm').reset();
            } catch (error) {
                showToast('Failed to add category', 'danger');
            }
        }
        
        function editProduct(productId) {
            // This would open an edit modal - for now just show a placeholder
            showToast('Edit product functionality would be implemented here', 'info');
        }
        
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                showToast('Delete product functionality would be implemented here', 'info');
            }
        }
        
        function editCategory(categoryId) {
            // This would open an edit modal - for now just show a placeholder
            showToast('Edit category functionality would be implemented here', 'info');
        }
        
        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                showToast('Delete category functionality would be implemented here', 'info');
            }
        }
        
        function goToStore() {
            window.location.href = 'index.html';
        }
        
        async function logout() {
            try {
                await apiCall('/auth/logout', 'POST');
                showToast('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } catch (error) {
                showToast('Logout failed', 'danger');
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', async function() {
            // Check admin authentication
            const isAuthenticated = await checkAdminAuth();
            if (!isAuthenticated) return;
            
            // Load initial data
            await loadDashboardData();
            
            // Navigation event listeners
            document.getElementById('dashboardTab').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('dashboard');
            });
            
            document.getElementById('productsTab').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('products');
            });
            
            document.getElementById('categoriesTab').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('categories');
            });
            
            document.getElementById('ordersTab').addEventListener('click', (e) => {
                e.preventDefault();
                showSection('orders');
            });
            
            // Form event listeners
            document.getElementById('addProductForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const productData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    stock_quantity: parseInt(document.getElementById('productStock').value),
                    category_id: parseInt(document.getElementById('productCategory').value),
                    image_url: document.getElementById('productImage').value,
                    sku: document.getElementById('productSku').value
                };
                
                await addProduct(productData);
            });
            
            document.getElementById('addCategoryForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const categoryData = {
                    name: document.getElementById('categoryName').value,
                    description: document.getElementById('categoryDescription').value,
                    image_url: document.getElementById('categoryImage').value
                };
                
                await addCategory(categoryData);
            });
            
            // When modals are shown, populate category dropdown
            document.getElementById('addProductModal').addEventListener('show.bs.modal', () => {
                populateProductCategories();
            });
        });
    </script>
</body>
</html>
